---
import PageLayout from "@/layouts/Base.astro";
import { getCollection } from "astro:content";

const slugFromId = (id: string) => id.replace(/\.(md|mdx)$/, "").split("/").pop()!;

const projects = (await getCollection("projects"))
	.sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999));
---

<PageLayout meta={{ title: "Projects" }}>
	<section>
		<h1 class="title mb-8">Projects</h1>

		<ul class="project-grid" role="list">
			{projects.map((p) => (
				<li class="project-card">
					<a class="project-link" href={`/projects/${slugFromId(p.id)}/`}>
						<div class="project-cover">
							<img src={p.data.cover} alt={`${p.data.title} cover`} loading="lazy" />
						</div>
						<div class="project-meta">
							<h2 class="project-title">{p.data.title}</h2>
						</div>
					</a>
				</li>
			))}
		</ul>
	</section>

	<style>
		.project-grid {
			display: grid;
			grid-template-columns: repeat(1, minmax(0, 1fr));
			gap: 1.25rem;
		}
		@media (min-width: 640px) {
			.project-grid {
				grid-template-columns: repeat(2, minmax(0, 1fr));
			}
		}

		.project-card {
			border: 1px solid var(--border, rgba(255,255,255,0.08));
			border-radius: 12px;
			overflow: hidden;
			background: var(--card-bg, transparent);
		}

		.project-link {
			display: block;
			text-decoration: none;
		}

		.project-cover {
			aspect-ratio: 16 / 9;
			background: rgba(255,255,255,0.04);
			overflow: hidden;
		}
		.project-cover img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			display: block;
		}

		.project-meta {
			padding: 0.9rem 1rem;
		}

		.project-title {
			margin: 0;
			font-size: 1rem;
			line-height: 1.3;
		}

		.project-card:hover {
			border-color: rgba(120, 180, 255, 0.35);
		}
	</style>
</PageLayout>